# Quick Merge Jenkins 插件价值说明

## 1. 背景与目标
在产品发布前，研发同学通常需要完成一系列“合并代码 + 生产分支准备 + 发布触发”的操作。这些步骤彼此依赖、顺序严格，且涉及多个分支和多人协作。过去主要靠人工记忆和经验来完成，导致：

- 操作步骤多、耗时长
- 容易因手误或遗漏导致返工
- 流程不统一，团队协作成本高

本插件的目标是：
- 将发布前的关键步骤标准化、流程化
- 减少人为差错，提高发布质量
- 降低新同学上手成本
- 保留必要的人工审批和发布把关

同时明确流程边界：测试环境可以全自动执行；生产环境默认只打开 Jenkins 页面，需要人工确认才会触发部署，确保可控和可审计。

## 2. 之前的操作流程（人工）
以下为简化后的典型流程（实际可能更复杂）：

1) 先确认当前分支、目标分支和最新发布分支
2) 手动创建当天的生产分支
3) 手动选择并逐个合并要上线的功能分支
4) 若出现冲突，靠人工排查并解决
5) 再手动推送到远端
6) 打开 Jenkins 页面，手动找到正确的 Job
7) 手动触发发布

**问题点：**
- 分支多时容易合错或漏合
- 新建生产分支容易忘记或格式不一致
- 冲突处理没有统一提示，容易遗漏处理步骤
- Jenkins 页面需要手动定位，操作冗长

## 3. 现在的操作流程（插件）
插件将流程收敛为 1~2 次按钮操作，核心变化：

1) 点击“Merge into Prod”
- 自动创建当天生产分支
- 支持多选要合并的功能分支
- 合并完成后自动打开 Jenkins 页面

2) 点击“Squash & Merge into Prod”
- 自动整理提交记录（减少无意义的历史信息）
- 再创建生产分支并完成合并
- 合并完成后自动打开 Jenkins 页面

3) 点击“Deploy to Prod / 部署到生产环境”
- 默认只打开 Jenkins 页面（不自动构建）
- 开启 `autoDeploy` 后才会进入“二次确认 + 按分支逐个确认”的自动触发流程
- 若最新生产分支日期不是今天，会提示并要求再次确认

之前分散在多处的步骤（建分支、合并、冲突提示、打开 Jenkins）现在都可以通过按钮一键式完成或一键式引导完成，减少手工切换与漏步骤；同时每个一键式流程都保留手动干预的入口，确保可控。

**说明：**生产环境默认不自动触发，插件只负责“合并 + 分支准备 + 打开 Jenkins 页面”；仅在显式开启 `autoDeploy` 时才会自动触发 Jenkins，且流程包含多次确认，确保发布可控、可审计。

## 3.1 需求分支创建流程（AI 辅助）
在新需求阶段，插件也做了“创建流程”的标准化，并引入 AI 自动生成，具体步骤如下：

1) 选择需求类型（如 feature/fix）
2) 输入中文需求描述
3) AI 自动翻译为英文，并据此生成规范化的分支名
4) 支持人工确认与微调分支名
5) 一键创建需求分支，并生成一条可追溯的记录（用于后续提交默认文案）

**价值：**减少命名不一致、漏步骤等问题，让新需求从一开始就进入可追踪、可复用的标准流程。

## 4. 新旧流程对比（非技术视角）

| 环节 | 之前（人工） | 现在（插件） | 收益 |
|---|---|---|---|
| 生产分支创建 | 手动创建，容易忘 | 自动创建 | 降低遗漏风险 |
| 选择合并分支 | 手动逐个合并 | 支持多选一次合并 | 效率提升 |
| 冲突处理 | 需要自己判断下一步 | 插件提示可操作入口 | 降低出错 |
| Jenkins 页面打开 | 手动查找 | 自动跳转 | 减少操作步骤 |
| 流程一致性 | 依赖个人经验 | 固化为标准流程 | 标准化 |

## 5. 业务价值

**1) 交付效率提升**
- 发布前准备流程从“多步手工”变成“一键操作”
- 发布动作更快，减少等待时间

**2) 风险降低**
- 自动校验和创建分支，避免分支命名错误
- 固化流程后，减少“人记流程”的风险

**3) 团队协作成本下降**
- 统一操作方式，降低跨团队沟通成本
- 新同学上手更快，不需要记复杂步骤

**4) 发布流程可控**
- 插件只做到“准备完成”，发布仍需人工触发
- 保留原有审批或发布检查机制

## 6. 当前能力范围与限制
**已覆盖：**
- 自动创建生产分支
- 多分支合并
- 冲突提醒与处理入口
- 合并完成后自动打开 Jenkins 页面
- 生产环境部署按钮与确认流程
- `prodPrefix` 支持字符串数组或对象数组，允许按分支前缀配置 Jenkins

**未覆盖（有意保留）：**
- 默认不自动触发生产发布（避免误发，保留人工控制）

## 7. 可量化收益
下面给出量化指标与记录方式，便于后续复盘与对比：

- 发布前准备耗时：在发布记录中统计从“开始准备”到“可触发 Jenkins”的平均耗时，按周或按版本对比
- 返工次数：统计因分支遗漏、分支命名错误、冲突处理遗漏导致的返工次数
- 上手成本：统计新人完成首次发布前准备所需的指导次数或时间
- 流程一致性：统计发布前流程中“缺少关键步骤”的事件数

## 8. 总结
本插件的价值不在于“增加一个工具”，而是**把原本复杂、容易出错的发布准备流程变成可控、可重复的标准流程**。

对于业务来说，它带来的是：
- 更快的交付效率
- 更稳定的发布质量
- 更低的团队协作成本
- 更可控的生产发布风险
